@(ps: models.PermissionScheme, perms: List[models.Permission], permGroups: Map[String,List[PermissionSchemeGroup]], permUsers: Map[String,List[PermissionSchemeUser]])(implicit request: AuthenticatedRequest)
@main(Messages("admin.permission_scheme.with.id", ps.name)) {
<ul class="breadcrumb">
 <li>
  <a href="@routes.Admin.index">@Messages("general.admin")</a> <span class="divider">@Messages("breadcrumb.divider")</span>
 </li>
 <li>
  <a href="@controllers.admin.routes.PermissionScheme.index()">@Messages("admin.permission_scheme.list")</a> <span class="divider">@Messages("breadcrumb.divider")</span>
 </li>
 <li class="active">@Messages(ps.name)</li>
</ul>
<table id="perm-table" class="table table-bordered table-striped">
 <thead>
  <tr>
   <th>@Messages("admin.permission")</th>
   <th>@Messages("admin.permission_scheme.groups")</th>
   <th>@Messages("admin.permission_scheme.users")</th>
  </tr>
 </thead>
 <tbody>
  @perms.map { perm =>
  <tr>
   <td><strong>@Messages(perm.name)</strong><p><small>@Messages(perm.name + "_DESC")</small></p></td>
   <td>
    <ul>
    @permGroups.get(perm.name).map { groups =>
      @groups.map { group =>
       <li><a href="@controllers.admin.routes.Group.item(group.groupId)">@group.groupName</a></li>
      }
    }
    </ul>
    <a class="group-adder" data-permission-id="@perm.name" data-permission-name="@Messages(perm.name)">XXX Add Group</a>
   </td>
   <td>
    <ul>
    @permUsers.get(perm.name).map { users =>
      @users.map { user =>
       <li><a href="@controllers.admin.routes.User.item(user.userId)">@user.username</a></li>
      }
    }
    </ul>
   </td>
  </tr>
  }
 </tbody>
</table>
<script>
YUI().use('emperor-models', 'panel', function (Y) {
  Y.one("#perm-table").delegate('click', function(e) {

    // Do the templatey bit for group or user here.
    var target = e.target;
    var template = Handlebars.compile(Y.one("#group-modal").getHTML());
    var html = template({
      permission_id: target.getAttribute('data-permission-id'),
      permission_name: target.getAttribute('data-permission-name')
    });

    var nestedPanel = new Y.Panel({
      headerContent: '@Messages("admin.permission_scheme.group.add.title")',
      bodyContent: html,
      zIndex     : 1031,
      centered   : true,
      modal      : true,
      render     : '#nestedPanel',
      buttons: [
        {
          value  : '@Messages("form.cancel")',
          section: Y.WidgetStdMod.FOOTER,
          classNames: 'btn',
          action : function (e) {
            e.preventDefault();
            nestedPanel.destroy(true);
          }
        },
        {
          value  : '@Messages("form.submit")',
          section: Y.WidgetStdMod.FOOTER,
          classNames: ['btn','btn-primary'],
          action : function (e) {
            e.preventDefault();
            nestedPanel.hide();
          }
        }
      ]
    });
  }, 'a.group-adder');
});
</script>
<script id="group-modal" type="text/x-handlebars-template">
@Messages("admin.permission_scheme.group.add.help")
{{permission_name}}
<form>
 <input type="hidden" name="permission_id" value="{{permission_id}}">
</form>
</script>
}