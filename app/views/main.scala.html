@(title : String)(content: Html)(implicit request: Request[AnyContent])

@import util._

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Emperor: @title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <link href='http://fonts.googleapis.com/css?family=Great+Vibes' rel='stylesheet' type='text/css'>
    <link href="@routes.Assets.at("stylesheets/bootstrap.min.css")" rel="stylesheet">
    <link href="@routes.Assets.at("stylesheets/main.less")" rel="stylesheet/less">
    <script src="@routes.Assets.at("js/less-1.3.0.min.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("js/jquery-1.7.2.min.js")"></script>
    <script src="@routes.Assets.at("js/bootstrap.min.js")"></script>
    <script src="@routes.Assets.at("js/handlebars-1.0.0.beta.6.js")"></script>
    <script src="@routes.Assets.at("js/global.js")"></script>
    <script src="http://yui.yahooapis.com/3.6.0/build/yui/yui-min.js"></script>
    <script src="@routes.Assets.at("js/config.js")"></script>
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <a class="brand" href="@routes.Core.index">Emperor</a>
          @topmenu(request)
        </div>
      </div>
    </div>
    <div class="container-fluid">
    <div id="alert-area">
      @{ request.flash.get("success") match {
        case Some(message) => {
          <div class="alert alert-success">
           <a class="close" data-dismiss="alert" href="#">&times;</a>
           { Messages(message) }
          </div>
        }
        case None => { }
      }
      }
      @{ request.flash.get("error") match {
        case Some(message) => {
          <div class="alert alert-error">
           <a class="close" data-dismiss="alert" href="#">&times;</a>
           { Messages(message) }
          </div>
        }
        case None => { }
      }
      }
      @{ request.flash.get("info") match {
        case Some(message) => {
          <div class="alert alert-info">
           <a class="close" data-dismiss="alert" href="#">&times;</a>
           { Messages(message) }
          </div>
        }
        case None => { }
      }
      }
    </div>
     @content
    </div>
   <script type="text/javascript">
   YUI().use('emperor-models', 'base', 'view', 'node', function (Y) {

    // Find a ticket id if we have one
    var tickId = null;
    var thead  = Y.one("#ticket-head");
    if(thead != null) {
      tickId = thead.getAttribute("data-ticket");

      Y.LinkerView = Y.Base.create('linkerView', Y.View, [], {
        events: {
          '#btn-start': { click: 'start' },
          '.remover': { click: 'stop' }
        },
        template: Y.one("#linker-template").getHTML(),
        initializer: function () {
          var model = this.get('model');

          model.after('change', this.render, this);
          model.after('destroy', this.render, this);
        },
        render: function () {
          var container = this.get('container');
          var source   = this.template;
          var template = Handlebars.compile(source);
          var html = template(this.get('model').toJSON());

          container.setHTML(html);

          return this;
        },
        start: function(e) {
          var model = this.get('model');
          model.set("ticket_id", tickId).save();
        },
        stop: function(e) {
          var model = this.get('model');
          // Causes a PUT with an empty ticket id. Hackish
          model.set("ticket_id", null).save();
        }
      }, {
        ATTRS: {
          container: {
            valueFn: function () {
              return Y.one('#linker');
            }
          }
        }
      });

      var linkTicket = new Y.LinkTicket({ id : tickId });
      linkTicket.load();

      var linkerView = new Y.LinkerView({ model: linkTicket });
      linkerView.render();
    }
   });
   </script>
   <script id="linker-template" type="text/x-handlebars-template">
    <div class="link-item">
    {{#if ticket_id}}
     <a class="btn btn-primary dropdown-toggle {{#if disabled}}disabled{{/if}}" data-toggle="dropdown" href="#">
       @Messages("ticket.linker.label") <i></i>{{ticket_id}}
       <span class="caret"></span>
     </a>
     <ul id="link-menu" class="dropdown-menu">
       XXX linker template
       <li class="divider"></li>
       <li><a href="/ticket/{{ticket_id}}"><i class="icon-eye-open"></i> @Messages("ticket.linker.view") <i></i>{{ticket_id}}</a></li>
       <li><a href="#" class="remover"><i class="icon-eject"></i> @Messages("ticket.linker.remove") <i></i>{{ticket_id}}</a></li>
     </ul>
    {{else}}
    <a class="btn" id="btn-start">@Messages("ticket.linker.action")</a>
    {{/if}}
    </div>
   </script>
   <script id="alerter" type="text/x-handlebars-template">
    <div class="alert {{alert_class}}">
     <a class="close" data-dismiss="alert" href="#">&times;</a>
     {{message}}
    </div>
   </script>
  </body>
</html>
